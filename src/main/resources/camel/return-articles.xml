<route id="direct_returnArticles"
  routeConfigurationId="generic-error"
  xmlns="http://camel.apache.org/schema/spring">

  <from uri="direct:returnArticles" />

  <split aggregationStrategy="#class:com.github.jacekszymanski.realcamel.ListAggregationStrategy"
         stopOnException="true">
    <simple>${body}</simple>

    <to uri="direct:returnArticle" />

    <!-- NOTE need to use .getArticle() as .article is a fluent setter which confuses camel -->
    <setBody>
      <simple>${body.getArticle()}</simple>
    </setBody>
  </split>

  <setBody>
    <groovy><![CDATA[
    new com.github.jacekszymanski.realcamel.model.GetArticlesFeed200Response()
      .articlesCount(exchange.properties.__articlesCount as int)
      .articles(request.body)
  ]]></groovy>
  </setBody>


</route>
