<routes>
  <route id="direct_followUserByUsername" routeConfigurationId="verify-login,generic-error,ignore-duplicate-error">
    <from uri="direct:followUserByUsername"/>

    <to uri="direct:getUserByName" />

    <filter>
      <simple>${body.id} == ${exchangeProperty.loggedInUser.id}</simple>

      <throwException message="You cannot follow yourself"
                      exceptionType="com.github.jacekszymanski.realcamel.RouteException" />
    </filter>

    <to uri="sql:classpath:sql/follow.sql" />

    <setHeader name="__me_follower">
      <constant resultType="java.lang.Integer">1</constant>
    </setHeader>

    <to uri="direct:returnUserProfile" />

  </route>
</routes>
