<route id="direct_createArticleComment"
       xmlns="http://camel.apache.org/schema/spring"
       routeConfigurationId="verify-login,generic-error">
  <from uri="direct:createArticleComment"/>

  <setProperty name="__comment"><simple>${body}</simple></setProperty>

  <!-- TODO this is evil, need to store the article right away in the property without touching body -->
  <to uri="direct:findArticle"/>
  <setProperty name="__article"><simple>${body}</simple></setProperty>

  <setBody><groovy>
    com.github.jacekszymanski.realcamel.entity.Comment.builder()
      .body(exchange.properties.__comment.comment.body)
      .author(exchange.properties.loggedInUser)
      .article(exchange.properties.__article)
      .build()
  </groovy></setBody>

  <to uri="jpa:com.github.jacekszymanski.realcamel.entity.Comment?usePersist=true"/>

  <to uri="direct:returnComment"/>

</route>
