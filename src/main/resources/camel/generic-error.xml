<routeConfigurations>
  <routeConfiguration id="generic-error">
    <onException>
      <exception>java.lang.Exception</exception>
      <handled>
        <constant>true</constant>
      </handled>

      <log message="exception ${exception}" logName="com.github.jacekszymanski.realcamel" loggingLevel="WARN"/>

      <setHeader name="CamelHttpResponseCode">
        <constant>422</constant>
      </setHeader>

      <setBody>
        <constant><![CDATA[
          {"errors": {"body": [ ]}}
        ]]></constant>
      </setBody>

      <unmarshal>
        <json unmarshalType="com.github.jacekszymanski.realcamel.model.GenericErrorModel"/>
      </unmarshal>

      <script>
        <groovy>
          <![CDATA[
            import static com.github.jacekszymanski.realcamel.util.ExceptionUtil.*

            request.body.errors.body.addAll(messages(exception(exchange)))
          ]]>
        </groovy>
      </script>

      <stop/>
    </onException>
  </routeConfiguration>
</routeConfigurations>
