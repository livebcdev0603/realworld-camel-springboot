<routes xmlns="http://camel.apache.org/schema/spring">
  <route id="direct:returnError">
    <from uri="direct:returnError" />

    <setBody>
      <constant><![CDATA[
          {"errors": {"body": [ ]}}
        ]]></constant>
    </setBody>

    <unmarshal>
      <json unmarshalType="com.github.jacekszymanski.realcamel.model.GenericErrorModel" />
    </unmarshal>

    <script>
      <groovy>
        <![CDATA[
            import static com.github.jacekszymanski.realcamel.util.ExceptionUtil.*

            String msg = exchange.properties.'ownErrorMessage'
            def errList = request.body.errors.body

            if (msg != null) {
              errList.add(msg)
            }

            errList.addAll(messages(exception(exchange)))
          ]]>
      </groovy>
    </script>

    <stop />

  </route>
</routes>
